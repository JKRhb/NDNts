---
dist: bionic

language: node_js
jobs:
  include:
  - node_js: '12'
  - node_js: '14'

addons:
  apt:
    sources:
      - sourceline: 'ppa:named-data/ppa-dev'
    packages:
      - build-essential
      - clang-format-6.0
      - libndn-cxx-dev
      - ndnsec

cache:
  npm: false
  directories:
    - $HOME/.pnpm-store

install:
  - npm install -g coveralls pnpm verdaccio

before_script:
  - npm run bootstrap

script:
  - npm run build
  - npm run literate lint
  - npm run literate
  - npm run lint-ci
  - npm run cover -- --colors
  - cd $TRAVIS_BUILD_DIR/integ/browser-tests && npm test
  - cd $TRAVIS_BUILD_DIR/integ/ndncxx-tests && npm test
  - cd $TRAVIS_BUILD_DIR

after_success:
  - coveralls <coverage/lcov.info
  - bash mk/publish-nightly.sh
  - npm run typedoc -- --gaId UA-935676-11

deploy:
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    local_dir: mk/nightly-output/
    repo: yoursunny/NDNts-nightly
    fqdn: ndnts-nightly.ndn.today
    on:
      branch: develop
      node_js: '14'
  - provider: netlify
    edge: true
    site: 8987d2bb-7638-4d6b-adff-806fe3b7309a
    auth: $NETLIFY_AUTH
    dir: docs/
    message: $TRAVIS_COMMIT
    prod: true
    on:
      branch: develop
      node_js: '14'
